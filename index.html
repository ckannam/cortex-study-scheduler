<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cortex Study Scheduler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background-color: #f4f4f4;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, select, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      margin-top: 1.5rem;
      cursor: pointer;
    }
    .output {
      margin-top: 2rem;
    }
    .about {
      max-width: 600px;
      margin: auto;
      background: #ffffffdd;
      padding: 1.5rem;
      border-radius: 10px;
      font-size: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .calendar-link {
      display: block;
      margin: 0.5rem 0;
      text-align: center;
    }
    .add-all-btn {
      background-color: #28a745;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cortex Study Scheduler</h1>
    <label for="topic">Topic Name:</label>
    <input type="text" id="topic" placeholder="e.g. Neurotransmitters">

    <label for="startDate">Date Learned:</label>
    <input type="date" id="startDate">

    <label for="learnTime">Time Learned:</label>
    <input type="time" id="learnTime">

    <label for="testDate">Test Date:</label>
    <input type="date" id="testDate">

    <label for="preferredWindow">Preferred Study Window:</label>
    <select id="preferredWindow">
      <option value="any">Anytime</option>
      <option value="evening">Evenings Only (4 PM – 10 PM)</option>
      <option value="morning">Mornings Only (8 AM – 12 PM)</option>
    </select>

    <button onclick="generateSchedule()">Generate Review Schedule</button>

    <div class="output" id="output"></div>
  </div>

  <div class="about">
    <h2>What We Do</h2>
    <p><strong>Cortex</strong> is a neuroscience-based study tool that helps students optimize memory retention by scheduling reviews based on the forgetting curve. We recommend optimal times to review material, based on when you learned it, your test date, and time of day. Built for students who want to study smarter, not harder.</p>
  </div>

  <script>
    const allEvents = [];

    function generateICSFile(events, topic) {
      const header = "BEGIN:VCALENDAR\nVERSION:2.0";
      const footer = "END:VCALENDAR";
      const eventsContent = events.map(date => {
        const dtStart = date.toISOString().replace(/[-:]|\.\d{3}/g, '').slice(0, 15);
        const dtEnd = new Date(date.getTime() + 60 * 60000).toISOString().replace(/[-:]|\.\d{3}/g, '').slice(0, 15);
        return `BEGIN:VEVENT\nSUMMARY:Review ${topic}\nDTSTART:${dtStart}\nDTEND:${dtEnd}\nDESCRIPTION:Spaced repetition review for ${topic}\nEND:VEVENT`;
      }).join("\n");

      const content = `${header}\n${eventsContent}\n${footer}`;
      const blob = new Blob([content], { type: 'text/calendar' });
      return URL.createObjectURL(blob);
    }

    function generateSchedule() {
      const topic = document.getElementById("topic").value;
      const startDate = new Date(document.getElementById("startDate").value);
      const learnTime = document.getElementById("learnTime").value;
      const testDate = new Date(document.getElementById("testDate").value);
      const preferredWindow = document.getElementById("preferredWindow").value;
      const output = document.getElementById("output");

      if (!topic || !startDate.getTime() || !learnTime || !testDate.getTime()) {
        output.innerHTML = '<p>Please enter all required fields.</p>';
        return;
      }

      const reviewTimes = [1, 3, 7, 14, 30];
      const reviewDates = [];
      let html = `<h3>Review Schedule for "${topic}"</h3><ul>`;

      reviewTimes.forEach(day => {
        const reviewDate = new Date(startDate);
        reviewDate.setDate(reviewDate.getDate() + day);

        const [hours, minutes] = learnTime.split(":");
        let reviewHour = (parseInt(hours) + 13) % 24;

        if (preferredWindow === "evening") {
          if (reviewHour < 16) reviewHour = 16;
          if (reviewHour > 22) reviewHour = 22;
        } else if (preferredWindow === "morning") {
          if (reviewHour < 8 || reviewHour > 12) reviewHour = 10;
        } else {
          if (reviewHour > 22) reviewHour = 22;
        }

        reviewDate.setHours(reviewHour);
        reviewDate.setMinutes(parseInt(minutes));

        if (reviewDate <= testDate) {
          reviewDates.push(new Date(reviewDate));
          html += `<li>Review on: <strong>${reviewDate.toLocaleString()}</strong> (Day ${day})</li>`;
        }
      });

      html += '</ul>';

      if (reviewDates.length > 0) {
        const calendarURL = generateICSFile(reviewDates, topic);
        html += `<a class="calendar-link add-all-btn" href="${calendarURL}" download="review-${topic}-all.ics">➕ Add All to Calendar</a>`;
      }

      const current = output.innerHTML;
      output.innerHTML = current + html;
    }
  </script>
</body>
</html>
